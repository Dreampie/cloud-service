apply plugin: "spring-boot"
apply plugin: "io.spring.dependency-management"
apply plugin: "docker"

dependencyManagement {
  imports {
    mavenBom "org.springframework.cloud:spring-cloud-starter-parent:${springCloudStarterVersion}"
  }
}

dependencies {
  compile(project(":user-service:user-service-definer"))
  compile("org.springframework.boot:spring-boot-starter-web") {
    exclude module: "spring-boot-starter-tomcat"
  }
  compile("org.springframework.boot:spring-boot-starter-undertow")
  compile("org.springframework.boot:spring-boot-starter-actuator")
  compile("org.springframework.boot:spring-boot-starter-data-mongodb")
  compile("org.springframework.cloud:spring-cloud-starter-hystrix")
  compile("org.springframework.cloud:spring-cloud-netflix-hystrix-amqp")
  compile("org.springframework.cloud:spring-cloud-starter-config")
  compile("org.springframework.cloud:spring-cloud-starter-eureka")
  compile("org.springframework.cloud:spring-cloud-starter-bus-amqp")
  testCompile("org.springframework.boot:spring-boot-starter-test")
}

install.enabled = false

task buildDocker(type: Docker, dependsOn: build) {
  tagVersion = project.version + ".1"
  maintainer = "Dreampie <Dreampie@outlook.com>"
  push = true
  applicationName = jar.baseName
  dockerfile = file("src/main/docker/Dockerfile")
  registry = dockerRegistry
  doFirst {
    copy {
      from jar
      into stageDir
    }
  }
}